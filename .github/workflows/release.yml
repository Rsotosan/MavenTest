name: Release Maven

on: 
  workflow_dispatch:
    inputs:
      release_version: # New version
        description: "Version of the new release"
        required: true


jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v2

        - name: Set up Apache Maven Central
          uses: actions/setup-java@v2
          with: # running setup-java to writes the settings.xml
            distribution: 'adopt'
            java-version: '11'
            server-id: ossrh # Value of the distributionManagement/repository/id field of the pom.xml
            server-username: OSSRH_USERNAME # env variable for username in deploy
            server-password: OSSRH_PASSWORD # env variable for token in deploy
            gpg-private-key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }} # Value of the GPG private key to import
            gpg-passphrase: MAVEN_GPG_PASSPHRASE # env variable for GPG private key passphrase

        - name: Build with Maven
          run: mvn -B package --file io.github.rsotosan.lib.parent/pom.xml
          
        - name: Publish package and commit in Github
          run: sh ./adm-scripts/do_release.sh ${{ github.event.inputs.release_version }}
          env:
            OSSRH_USERNAME: rsotosan
            OSSRH_PASSWORD: ${{ secrets.OSSRH_PASSWORD }}